<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0a0f">
    <title>IdeaForge</title>
    <link rel="manifest" href="manifest.json">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #0a0a0f;
            --bg-card: #12121a;
            --bg-elevated: #1a1a24;
            --accent-primary: #00d4aa;
            --accent-secondary: #7c3aed;
            --accent-tertiary: #f59e0b;
            --accent-danger: #ef4444;
            --text-primary: #f0f0f5;
            --text-secondary: #8888a0;
            --text-muted: #555566;
            --border-subtle: rgba(255,255,255,0.06);
            --glow-primary: rgba(0, 212, 170, 0.3);
            --safe-top: env(safe-area-inset-top, 20px);
            --safe-bottom: env(safe-area-inset-bottom, 20px);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --radius-xl: 28px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Outfit', -apple-system, sans-serif;
            background: var(--bg-deep);
            color: var(--text-primary);
            min-height: 100vh;
            min-height: 100dvh;
            overflow-x: hidden;
            padding-top: var(--safe-top);
            padding-bottom: var(--safe-bottom);
        }
        body::before {
            content: '';
            position: fixed;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(0, 212, 170, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(124, 58, 237, 0.08) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }
        h1, h2, h3 { font-weight: 600; letter-spacing: -0.02em; }
        .mono { font-family: 'Space Mono', monospace; }
        .screen {
            display: none;
            min-height: calc(100vh - var(--safe-top) - var(--safe-bottom));
            min-height: calc(100dvh - var(--safe-top) - var(--safe-bottom));
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }
        .screen.active { display: block; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 24px;
            border: none;
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 48px;
        }
        .btn-primary { background: var(--accent-primary); color: var(--bg-deep); }
        .btn-primary:active { transform: scale(0.97); background: #00b894; }
        .btn-secondary { background: var(--bg-elevated); color: var(--text-primary); border: 1px solid var(--border-subtle); }
        .btn-ghost { background: transparent; color: var(--text-secondary); }
        .btn-full { width: 100%; }
        .btn-icon { width: 48px; height: 48px; padding: 0; border-radius: 50%; }
        input, textarea, select {
            width: 100%;
            padding: 14px 16px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 16px;
            transition: border-color 0.2s;
        }
        input:focus, textarea:focus, select:focus { outline: none; border-color: var(--accent-primary); }
        textarea { resize: none; min-height: 120px; }
        label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .input-group { margin-bottom: 20px; }
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 12px;
        }
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }
        .header h1 { font-size: 28px; }
        .header-actions { display: flex; gap: 8px; }

        /* Onboarding */
        #onboarding-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 40px 24px;
        }
        .onboarding-logo {
            font-size: 64px;
            text-align: center;
            margin-bottom: 24px;
            animation: pulse 2s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .onboarding-title {
            font-size: 36px;
            text-align: center;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .onboarding-subtitle {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 40px;
            font-size: 17px;
        }
        .onboarding-step { display: none; }
        .onboarding-step.active { display: block; animation: fadeIn 0.3s ease; }
        .step-indicator { display: flex; justify-content: center; gap: 8px; margin-bottom: 32px; }
        .step-dot {
            width: 8px; height: 8px;
            border-radius: 50%;
            background: var(--text-muted);
            transition: all 0.3s;
        }
        .step-dot.active { background: var(--accent-primary); width: 24px; border-radius: 4px; }
        .profession-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 24px; }
        .profession-option {
            padding: 16px;
            background: var(--bg-elevated);
            border: 2px solid var(--border-subtle);
            border-radius: var(--radius-md);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .profession-option:active { transform: scale(0.97); }
        .profession-option.selected { border-color: var(--accent-primary); background: rgba(0, 212, 170, 0.1); }
        .profession-option .icon { font-size: 28px; margin-bottom: 8px; }
        .profession-option .label { font-size: 14px; font-weight: 500; }

        /* Ideas Grid */
        .ideas-grid { display: flex; flex-direction: column; gap: 12px; padding-bottom: 100px; }
        .idea-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            padding: 18px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        .idea-card:active { transform: scale(0.98); }
        .idea-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 4px; height: 100%;
            background: var(--category-color, var(--accent-primary));
        }
        .idea-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
        .idea-category {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--category-color, var(--accent-primary));
            padding: 4px 10px;
            background: rgba(0, 212, 170, 0.1);
            border-radius: 20px;
        }
        .idea-date { font-size: 12px; color: var(--text-muted); font-family: 'Space Mono', monospace; }
        .idea-title { font-size: 17px; font-weight: 600; margin-bottom: 8px; line-height: 1.3; }
        .idea-preview {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .idea-meta {
            display: flex;
            gap: 12px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-subtle);
        }
        .idea-meta-item { display: flex; align-items: center; gap: 4px; font-size: 12px; color: var(--text-muted); }

        /* FAB */
        .fab-container {
            position: fixed;
            bottom: calc(90px + var(--safe-bottom));
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
        }
        .fab {
            width: 72px; height: 72px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-primary), #00b894);
            border: none;
            color: var(--bg-deep);
            font-size: 32px;
            cursor: pointer;
            box-shadow: 0 4px 20px var(--glow-primary), 0 0 40px var(--glow-primary);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .fab:active { transform: scale(0.92); }
        .fab.recording {
            background: linear-gradient(135deg, var(--accent-danger), #dc2626);
            box-shadow: 0 4px 20px rgba(239, 68, 68, 0.4);
            animation: recordPulse 1s ease-in-out infinite;
        }
        @keyframes recordPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Recording Timer */
        .recording-timer {
            position: fixed;
            bottom: calc(170px + var(--safe-bottom));
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-elevated);
            padding: 8px 20px;
            border-radius: 20px;
            font-family: 'Space Mono', monospace;
            font-size: 18px;
            color: var(--accent-danger);
            display: none;
            z-index: 100;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        .recording-timer.visible { display: block; animation: fadeIn 0.2s ease; }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border-subtle);
            padding: 12px 20px calc(12px + var(--safe-bottom));
            display: flex;
            justify-content: space-around;
            z-index: 50;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 16px;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 11px;
            font-family: inherit;
            cursor: pointer;
            transition: color 0.2s;
        }
        .nav-item.active { color: var(--accent-primary); }
        .nav-item .icon { font-size: 22px; }

        /* Capture Screen */
        #capture-screen { padding-bottom: 120px; }
        .capture-header { text-align: center; margin-bottom: 32px; }
        .capture-header h2 { font-size: 24px; margin-bottom: 8px; }
        .capture-header p { color: var(--text-secondary); }
        .capture-area {
            background: var(--bg-card);
            border: 2px dashed var(--border-subtle);
            border-radius: var(--radius-xl);
            padding: 40px 24px;
            text-align: center;
            margin-bottom: 24px;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        .capture-area.has-content { border-style: solid; border-color: var(--accent-primary); text-align: left; align-items: stretch; }
        .capture-placeholder { color: var(--text-muted); }
        .capture-placeholder .icon { font-size: 48px; margin-bottom: 16px; }
        .capture-text {
            width: 100%;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 17px;
            line-height: 1.6;
            resize: none;
            min-height: 150px;
        }
        .capture-text:focus { outline: none; }
        .voice-btn {
            width: 100%;
            height: 64px;
            border-radius: var(--radius-lg);
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            color: var(--text-primary);
            font-size: 16px;
            font-family: inherit;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.2s;
        }
        .voice-btn:active { transform: scale(0.98); }
        .voice-btn.recording { background: rgba(239, 68, 68, 0.1); border-color: var(--accent-danger); color: var(--accent-danger); }
        .voice-btn .icon { font-size: 24px; }

        /* Category Selection */
        .category-selector { margin: 24px 0; }
        .category-chips { display: flex; flex-wrap: wrap; gap: 10px; }
        .category-chip {
            padding: 10px 18px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 24px;
            font-size: 14px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }
        .category-chip:active { transform: scale(0.95); }
        .category-chip.selected { background: var(--category-color, var(--accent-primary)); color: var(--bg-deep); border-color: transparent; }
        .category-chip.add-new { border-style: dashed; }

        /* Detail Screen */
        .detail-header { margin-bottom: 24px; }
        .detail-back {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            background: none;
            border: none;
            font-size: 15px;
            font-family: inherit;
            cursor: pointer;
            margin-bottom: 20px;
            padding: 0;
        }
        .detail-category {
            display: inline-block;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--accent-primary);
            margin-bottom: 12px;
        }
        .detail-title { font-size: 28px; line-height: 1.2; margin-bottom: 8px; }
        .detail-date { font-size: 13px; color: var(--text-muted); font-family: 'Space Mono', monospace; }
        .detail-content { font-size: 17px; line-height: 1.7; color: var(--text-secondary); margin-bottom: 32px; }

        /* Mentors */
        .mentors-section { margin-top: 32px; }
        .mentors-section h3 { font-size: 18px; margin-bottom: 16px; display: flex; align-items: center; gap: 10px; }
        .mentor-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 20px; }
        .mentor-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .mentor-card:active { transform: scale(0.97); }
        .mentor-card.selected { border-color: var(--accent-secondary); background: rgba(124, 58, 237, 0.1); }
        .mentor-avatar { font-size: 32px; margin-bottom: 8px; }
        .mentor-name { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
        .mentor-role { font-size: 11px; color: var(--text-muted); }
        .mentor-feedback {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-top: 16px;
            display: none;
        }
        .mentor-feedback.visible { display: block; animation: fadeIn 0.3s ease; }
        .mentor-feedback-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-subtle);
        }
        .mentor-feedback-avatar { font-size: 28px; }
        .mentor-feedback-info h4 { font-size: 15px; margin-bottom: 2px; }
        .mentor-feedback-info span { font-size: 12px; color: var(--text-muted); }
        .mentor-feedback-content { font-size: 15px; line-height: 1.7; color: var(--text-secondary); white-space: pre-wrap; }

        /* Action Buttons */
        .detail-actions { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 24px; }
        .action-btn {
            padding: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .action-btn:active { transform: scale(0.97); }
        .action-btn .icon { font-size: 24px; margin-bottom: 8px; }
        .action-btn .label { font-size: 13px; color: var(--text-secondary); }

        /* Connections */
        .connections-header { text-align: center; margin-bottom: 32px; }
        .connections-header h2 { font-size: 24px; margin-bottom: 8px; }
        .connection-group {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 16px;
        }
        .connection-theme {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--accent-secondary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .connection-ideas { display: flex; flex-direction: column; gap: 10px; }
        .connection-idea { background: var(--bg-elevated); border-radius: var(--radius-sm); padding: 12px; font-size: 14px; cursor: pointer; }
        .connection-insight {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-subtle);
            font-size: 14px;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* Settings */
        .settings-section { margin-bottom: 32px; }
        .settings-section h3 {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 12px;
        }
        .settings-item {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            padding: 16px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }
        .settings-item-left { display: flex; align-items: center; gap: 12px; }
        .settings-item .icon { font-size: 20px; }
        .settings-item-label { font-size: 15px; }
        .settings-item-value { font-size: 14px; color: var(--text-muted); }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: flex-end;
            justify-content: center;
            z-index: 200;
            padding: 20px;
            padding-bottom: var(--safe-bottom);
        }
        .modal-overlay.visible { display: flex; animation: fadeIn 0.2s ease; }
        .modal {
            background: var(--bg-card);
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
            padding: 24px;
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-header h3 { font-size: 20px; }
        .modal-close { background: none; border: none; font-size: 24px; color: var(--text-muted); cursor: pointer; }

        /* Empty State */
        .empty-state { text-align: center; padding: 60px 20px; }
        .empty-state .icon { font-size: 64px; margin-bottom: 20px; opacity: 0.5; }
        .empty-state h3 { font-size: 20px; margin-bottom: 8px; }
        .empty-state p { color: var(--text-secondary); margin-bottom: 24px; }

        /* Loading */
        .loading { display: flex; align-items: center; justify-content: center; gap: 8px; padding: 20px; color: var(--text-muted); }
        .loading-spinner {
            width: 20px; height: 20px;
            border: 2px solid var(--border-subtle);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Toast */
        .toast {
            position: fixed;
            bottom: calc(100px + var(--safe-bottom));
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--bg-elevated);
            color: var(--text-primary);
            padding: 14px 24px;
            border-radius: var(--radius-md);
            font-size: 14px;
            z-index: 300;
            opacity: 0;
            transition: all 0.3s ease;
            border: 1px solid var(--border-subtle);
        }
        .toast.visible { opacity: 1; transform: translateX(-50%) translateY(0); }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid var(--border-subtle);
        }
        .stat-item { text-align: center; }
        .stat-value { font-size: 24px; font-weight: 700; color: var(--accent-primary); font-family: 'Space Mono', monospace; }
        .stat-label { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }

        /* Filters */
        .filters {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 16px;
            margin-bottom: 16px;
            -webkit-overflow-scrolling: touch;
        }
        .filter-chip {
            flex-shrink: 0;
            padding: 8px 16px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            font-size: 13px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }
        .filter-chip.active { background: var(--accent-primary); color: var(--bg-deep); border-color: transparent; }

        /* Category Colors */
        [data-category="negocio"] { --category-color: #00d4aa; }
        [data-category="producto"] { --category-color: #7c3aed; }
        [data-category="contenido"] { --category-color: #f59e0b; }
        [data-category="personal"] { --category-color: #ec4899; }
        [data-category="tech"] { --category-color: #3b82f6; }
        [data-category="otro"] { --category-color: #6b7280; }
    </style>
</head>
<body>
    <!-- Onboarding Screen -->
    <div id="onboarding-screen" class="screen active">
        <div class="onboarding-logo">üí°</div>
        <h1 class="onboarding-title">IdeaForge</h1>
        <p class="onboarding-subtitle">Captura, refina y conecta tus ideas</p>
        
        <div class="step-indicator">
            <div class="step-dot active" data-step="1"></div>
            <div class="step-dot" data-step="2"></div>
            <div class="step-dot" data-step="3"></div>
        </div>

        <div class="onboarding-step active" data-step="1">
            <div class="input-group">
                <label>¬øA qu√© te dedicas?</label>
                <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 16px;">Esto ayuda a los mentores a darte feedback relevante</p>
                <div class="profession-grid">
                    <div class="profession-option" data-value="emprendedor"><div class="icon">üöÄ</div><div class="label">Emprendedor</div></div>
                    <div class="profession-option" data-value="creativo"><div class="icon">üé®</div><div class="label">Creativo</div></div>
                    <div class="profession-option" data-value="developer"><div class="icon">üíª</div><div class="label">Developer</div></div>
                    <div class="profession-option" data-value="consultor"><div class="icon">üìä</div><div class="label">Consultor</div></div>
                    <div class="profession-option" data-value="academico"><div class="icon">üìö</div><div class="label">Acad√©mico</div></div>
                    <div class="profession-option" data-value="marketing"><div class="icon">üì¢</div><div class="label">Marketing</div></div>
                </div>
                <input type="text" id="custom-profession" placeholder="O escribe tu profesi√≥n...">
            </div>
            <button class="btn btn-primary btn-full" onclick="nextOnboardingStep()">Continuar</button>
        </div>

        <div class="onboarding-step" data-step="2">
            <div class="input-group">
                <label>Cu√©ntame m√°s sobre ti</label>
                <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 16px;">¬øEn qu√© industria? ¬øQu√© tipo de proyectos? ¬øQu√© te apasiona?</p>
                <textarea id="user-context" placeholder="Ej: Soy dise√±ador UX en una startup fintech. Me apasiona crear productos que simplifiquen la vida..."></textarea>
            </div>
            <div style="display: flex; gap: 12px;">
                <button class="btn btn-secondary" onclick="prevOnboardingStep()">Atr√°s</button>
                <button class="btn btn-primary" style="flex: 1;" onclick="nextOnboardingStep()">Continuar</button>
            </div>
        </div>

        <div class="onboarding-step" data-step="3">
            <div class="input-group">
                <label>API Key de OpenAI</label>
                <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 16px;">Necesaria para transcripci√≥n y mentores IA. Se guarda solo en tu dispositivo.</p>
                <input type="password" id="api-key-input" placeholder="sk-...">
            </div>
            <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 20px;">üí° Obt√©n tu API key en <a href="https://platform.openai.com/api-keys" target="_blank" style="color: var(--accent-primary);">platform.openai.com</a></p>
            <div style="display: flex; gap: 12px;">
                <button class="btn btn-secondary" onclick="prevOnboardingStep()">Atr√°s</button>
                <button class="btn btn-primary" style="flex: 1;" onclick="completeOnboarding()">Comenzar</button>
            </div>
        </div>
    </div>

    <!-- Main Screen -->
    <div id="main-screen" class="screen">
        <div class="header">
            <h1>Ideas</h1>
            <div class="header-actions">
                <button class="btn btn-icon btn-ghost" onclick="showSearch()">üîç</button>
                <button class="btn btn-icon btn-ghost" onclick="showScreen('settings-screen')">‚öôÔ∏è</button>
            </div>
        </div>
        <div class="stats-bar">
            <div class="stat-item"><div class="stat-value" id="total-ideas">0</div><div class="stat-label">Ideas</div></div>
            <div class="stat-item"><div class="stat-value" id="total-categories">0</div><div class="stat-label">Categor√≠as</div></div>
            <div class="stat-item"><div class="stat-value" id="total-connections">0</div><div class="stat-label">Conexiones</div></div>
        </div>
        <div class="filters" id="category-filters"><div class="filter-chip active" data-filter="all">Todas</div></div>
        <div class="ideas-grid" id="ideas-grid">
            <div class="empty-state">
                <div class="icon">üí≠</div>
                <h3>Tu primera idea te espera</h3>
                <p>Presiona el bot√≥n de micr√≥fono para capturar tu primera idea por voz</p>
            </div>
        </div>
    </div>

    <!-- Capture Screen -->
    <div id="capture-screen" class="screen">
        <button class="detail-back" onclick="showScreen('main-screen')">‚Üê Cancelar</button>
        <div class="capture-header">
            <h2>Nueva Idea</h2>
            <p>Habla o escribe tu idea</p>
        </div>
        <div class="capture-area" id="capture-area">
            <div class="capture-placeholder" id="capture-placeholder">
                <div class="icon">üé§</div>
                <p>Toca el micr√≥fono para grabar<br>o escribe directamente</p>
            </div>
            <textarea class="capture-text" id="capture-text" placeholder="Escribe tu idea aqu√≠..." style="display: none;"></textarea>
        </div>
        <button class="voice-btn" id="voice-btn" onclick="toggleRecording()">
            <span class="icon">üé§</span>
            <span id="voice-btn-text">Grabar idea</span>
        </button>
        <div class="category-selector">
            <label>Categor√≠a</label>
            <div class="category-chips" id="category-chips">
                <div class="category-chip" data-category="negocio" style="--category-color: #00d4aa;">üíº Negocio</div>
                <div class="category-chip" data-category="producto" style="--category-color: #7c3aed;">üì¶ Producto</div>
                <div class="category-chip" data-category="contenido" style="--category-color: #f59e0b;">‚úçÔ∏è Contenido</div>
                <div class="category-chip" data-category="personal" style="--category-color: #ec4899;">üå± Personal</div>
                <div class="category-chip" data-category="tech" style="--category-color: #3b82f6;">üîß Tech</div>
                <div class="category-chip add-new" onclick="showAddCategoryModal()">+ Nueva</div>
            </div>
        </div>
        <div class="input-group">
            <label>T√≠tulo (opcional)</label>
            <input type="text" id="idea-title" placeholder="La IA generar√° uno si lo dejas vac√≠o">
        </div>
        <button class="btn btn-primary btn-full" id="save-idea-btn" onclick="saveIdea()" disabled>Guardar Idea</button>
    </div>

    <!-- Detail Screen -->
    <div id="detail-screen" class="screen">
        <div class="detail-header">
            <button class="detail-back" onclick="showScreen('main-screen')">‚Üê Volver</button>
            <div class="detail-category" id="detail-category">NEGOCIO</div>
            <h1 class="detail-title" id="detail-title">T√≠tulo de la idea</h1>
            <div class="detail-date" id="detail-date">15 Mar 2024</div>
        </div>
        <div class="detail-content" id="detail-content">Contenido de la idea...</div>
        <div class="detail-actions">
            <div class="action-btn" onclick="editIdea()"><div class="icon">‚úèÔ∏è</div><div class="label">Editar</div></div>
            <div class="action-btn" onclick="showInsights()"><div class="icon">üí°</div><div class="label">Insights</div></div>
            <div class="action-btn" onclick="showRoadmap()"><div class="icon">üó∫Ô∏è</div><div class="label">Roadmap</div></div>
            <div class="action-btn" onclick="deleteIdea()"><div class="icon">üóëÔ∏è</div><div class="label">Eliminar</div></div>
        </div>
        <div class="mentors-section">
            <h3>üß† Consulta a un Mentor</h3>
            <div class="mentor-grid" id="mentor-grid">
                <div class="mentor-card" data-mentor="strategist" onclick="selectMentor('strategist')"><div class="mentor-avatar">üéØ</div><div class="mentor-name">El Estratega</div><div class="mentor-role">Viabilidad y mercado</div></div>
                <div class="mentor-card" data-mentor="critic" onclick="selectMentor('critic')"><div class="mentor-avatar">üî•</div><div class="mentor-name">El Cr√≠tico</div><div class="mentor-role">Ve las fallas</div></div>
                <div class="mentor-card" data-mentor="creative" onclick="selectMentor('creative')"><div class="mentor-avatar">‚ú®</div><div class="mentor-name">El Creativo</div><div class="mentor-role">Expande la idea</div></div>
                <div class="mentor-card" data-mentor="pragmatic" onclick="selectMentor('pragmatic')"><div class="mentor-avatar">üî®</div><div class="mentor-name">El Pragm√°tico</div><div class="mentor-role">C√≥mo ejecutar</div></div>
                <div class="mentor-card" data-mentor="investor" onclick="selectMentor('investor')"><div class="mentor-avatar">üí∞</div><div class="mentor-name">El Inversor</div><div class="mentor-role">N√∫meros y ROI</div></div>
                <div class="mentor-card" data-mentor="user" onclick="selectMentor('user')"><div class="mentor-avatar">üë§</div><div class="mentor-name">El Usuario</div><div class="mentor-role">Perspectiva cliente</div></div>
            </div>
            <button class="btn btn-secondary btn-full" id="consult-mentor-btn" onclick="consultMentor()" style="display: none;">Consultar Mentor</button>
            <div class="mentor-feedback" id="mentor-feedback">
                <div class="mentor-feedback-header">
                    <div class="mentor-feedback-avatar" id="feedback-avatar">üéØ</div>
                    <div class="mentor-feedback-info"><h4 id="feedback-name">El Estratega</h4><span id="feedback-role">Viabilidad y mercado</span></div>
                </div>
                <div class="mentor-feedback-content" id="feedback-content">Feedback del mentor...</div>
            </div>
        </div>
    </div>

    <!-- Connections Screen -->
    <div id="connections-screen" class="screen">
        <div class="header"><h1>Conexiones</h1></div>
        <div class="connections-header"><p style="color: var(--text-secondary);">Ideas que podr√≠an potenciarse juntas</p></div>
        <div id="connections-list">
            <div class="empty-state">
                <div class="icon">üîó</div>
                <h3>A√∫n no hay conexiones</h3>
                <p>Necesitas al menos 3 ideas para encontrar patrones</p>
            </div>
        </div>
        <button class="btn btn-primary btn-full" onclick="findConnections()" style="margin-top: 24px;" id="find-connections-btn">üîç Buscar Conexiones</button>
    </div>

    <!-- Settings Screen -->
    <div id="settings-screen" class="screen">
        <div class="header">
            <h1>Ajustes</h1>
            <button class="btn btn-ghost" onclick="showScreen('main-screen')">Cerrar</button>
        </div>
        <div class="settings-section">
            <h3>Tu Perfil</h3>
            <div class="settings-item" onclick="showEditProfile()">
                <div class="settings-item-left"><span class="icon">üë§</span><span class="settings-item-label">Profesi√≥n y contexto</span></div>
                <span class="settings-item-value" id="settings-profession">Emprendedor</span>
            </div>
        </div>
        <div class="settings-section">
            <h3>API</h3>
            <div class="settings-item" onclick="showEditApiKey()">
                <div class="settings-item-left"><span class="icon">üîë</span><span class="settings-item-label">API Key OpenAI</span></div>
                <span class="settings-item-value">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>
            </div>
        </div>
        <div class="settings-section">
            <h3>Datos</h3>
            <div class="settings-item" onclick="exportData()"><div class="settings-item-left"><span class="icon">üì§</span><span class="settings-item-label">Exportar datos</span></div></div>
            <div class="settings-item" onclick="importData()"><div class="settings-item-left"><span class="icon">üì•</span><span class="settings-item-label">Importar backup</span></div></div>
            <div class="settings-item" onclick="clearAllData()" style="border-color: rgba(239, 68, 68, 0.3);"><div class="settings-item-left"><span class="icon">üóëÔ∏è</span><span class="settings-item-label" style="color: var(--accent-danger);">Borrar todo</span></div></div>
        </div>
        <div class="settings-section">
            <h3>Acerca de</h3>
            <div class="settings-item"><div class="settings-item-left"><span class="icon">üí°</span><span class="settings-item-label">IdeaForge</span></div><span class="settings-item-value">v1.0.0</span></div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="insights-modal">
        <div class="modal">
            <div class="modal-header"><h3>üí° Insights</h3><button class="modal-close" onclick="closeModal('insights-modal')">√ó</button></div>
            <div id="insights-content"><div class="loading"><div class="loading-spinner"></div><span>Analizando tu idea...</span></div></div>
        </div>
    </div>
    <div class="modal-overlay" id="roadmap-modal">
        <div class="modal">
            <div class="modal-header"><h3>üó∫Ô∏è Roadmap</h3><button class="modal-close" onclick="closeModal('roadmap-modal')">√ó</button></div>
            <div id="roadmap-content"><div class="loading"><div class="loading-spinner"></div><span>Creando tu roadmap...</span></div></div>
        </div>
    </div>
    <div class="modal-overlay" id="category-modal">
        <div class="modal">
            <div class="modal-header"><h3>Nueva Categor√≠a</h3><button class="modal-close" onclick="closeModal('category-modal')">√ó</button></div>
            <div class="input-group"><label>Nombre</label><input type="text" id="new-category-name" placeholder="Ej: Hobbies"></div>
            <div class="input-group"><label>Emoji</label><input type="text" id="new-category-emoji" placeholder="Ej: üéÆ" maxlength="2"></div>
            <button class="btn btn-primary btn-full" onclick="addCategory()">Crear Categor√≠a</button>
        </div>
    </div>

    <!-- FAB -->
    <div class="fab-container" id="fab-container"><button class="fab" id="main-fab" onclick="showScreen('capture-screen')">üé§</button></div>
    
    <!-- Recording Timer -->
    <div class="recording-timer" id="recording-timer">00:00</div>

    <!-- Bottom Nav -->
    <div class="bottom-nav" id="bottom-nav">
        <button class="nav-item active" data-screen="main-screen" onclick="showScreen('main-screen')"><span class="icon">üí°</span><span>Ideas</span></button>
        <button class="nav-item" data-screen="connections-screen" onclick="showScreen('connections-screen')"><span class="icon">üîó</span><span>Conexiones</span></button>
        <button class="nav-item" data-screen="settings-screen" onclick="showScreen('settings-screen')"><span class="icon">‚öôÔ∏è</span><span>Ajustes</span></button>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">Mensaje</div>
    <input type="file" id="import-file" accept=".json" style="display: none;">

    <script>
        // ==================== STATE ====================
        let state = {
            user: null,
            ideas: [],
            categories: [
                { id: 'negocio', name: 'Negocio', emoji: 'üíº', color: '#00d4aa' },
                { id: 'producto', name: 'Producto', emoji: 'üì¶', color: '#7c3aed' },
                { id: 'contenido', name: 'Contenido', emoji: '‚úçÔ∏è', color: '#f59e0b' },
                { id: 'personal', name: 'Personal', emoji: 'üå±', color: '#ec4899' },
                { id: 'tech', name: 'Tech', emoji: 'üîß', color: '#3b82f6' }
            ],
            connections: [],
            currentIdea: null,
            selectedMentor: null,
            isRecording: false,
            mediaRecorder: null,
            audioChunks: [],
            recordingStartTime: null,
            recordingTimer: null
        };

        // ==================== MENTORS ====================
        const MENTORS = {
            strategist: {
                name: 'El Estratega', avatar: 'üéØ', role: 'Viabilidad y mercado',
                prompt: `Eres un estratega de negocios con 20 a√±os de experiencia. Analiza esta idea desde: tama√±o del mercado, competencia, barreras de entrada, modelo de negocio viable, timing. S√© directo, conciso y accionable. Responde en espa√±ol.`
            },
            critic: {
                name: 'El Cr√≠tico', avatar: 'üî•', role: 'Ve las fallas',
                prompt: `Eres un cr√≠tico brutal pero constructivo. Encuentra TODAS las fallas: qu√© puede salir mal, qu√© ignora el creador, puntos ciegos, por qu√© podr√≠a fracasar. NO seas amable. S√© honesto. Termina con UNA sugerencia para mejorar. Responde en espa√±ol.`
            },
            creative: {
                name: 'El Creativo', avatar: '‚ú®', role: 'Expande la idea',
                prompt: `Eres un director creativo visionario. EXPANDE esta idea: c√≥mo podr√≠a ser 10x m√°s grande, variaciones interesantes, con qu√© combinar, c√≥mo sorprender al mercado. Piensa fuera de la caja. S√© provocador. Responde en espa√±ol.`
            },
            pragmatic: {
                name: 'El Pragm√°tico', avatar: 'üî®', role: 'C√≥mo ejecutar',
                prompt: `Eres un COO experto en ejecuci√≥n. Convierte esta idea en ACCI√ìN: primer paso concreto, recursos m√≠nimos, tiempo para MVP, qu√© hacer esta semana. S√© ultra-pr√°ctico. Cero filosof√≠a, pura ejecuci√≥n. Responde en espa√±ol.`
            },
            investor: {
                name: 'El Inversor', avatar: 'üí∞', role: 'N√∫meros y ROI',
                prompt: `Eres un inversor √°ngel que ha visto 1000+ pitches. Eval√∫a: costo de validar, potencial de retorno, escalabilidad, en qu√© punto invertir√≠as. Piensa riesgo/recompensa. S√© esc√©ptico pero justo. Responde en espa√±ol.`
            },
            user: {
                name: 'El Usuario', avatar: 'üë§', role: 'Perspectiva cliente',
                prompt: `Eres un usuario potencial t√≠pico. Reacciona: ¬øpagar√≠as? ¬øcu√°nto?, qu√© te har√≠a usarlo diario, qu√© te frustrar√≠a, ¬ølo recomendar√≠as? S√© honesto como usuario real. Responde en espa√±ol.`
            }
        };

        // ==================== INITIALIZATION ====================
        function init() {
            loadState();
            if (state.user && state.user.apiKey) {
                showScreen('main-screen');
                renderIdeas();
                updateStats();
            } else {
                showScreen('onboarding-screen');
            }
            document.querySelectorAll('.category-chip:not(.add-new)').forEach(chip => {
                chip.addEventListener('click', () => selectCategory(chip));
            });
            document.getElementById('capture-text').addEventListener('input', function() {
                document.getElementById('save-idea-btn').disabled = !this.value.trim();
            });
            document.getElementById('import-file').addEventListener('change', handleImport);
        }

        function loadState() {
            const saved = localStorage.getItem('ideaforge-state');
            if (saved) { state = { ...state, ...JSON.parse(saved) }; }
        }

        function saveState() {
            localStorage.setItem('ideaforge-state', JSON.stringify({
                user: state.user, ideas: state.ideas, categories: state.categories, connections: state.connections
            }));
        }

        // ==================== ONBOARDING ====================
        let currentOnboardingStep = 1;

        function nextOnboardingStep() {
            if (currentOnboardingStep === 1) {
                const selected = document.querySelector('.profession-option.selected');
                const custom = document.getElementById('custom-profession').value.trim();
                if (!selected && !custom) { showToast('Selecciona o escribe tu profesi√≥n'); return; }
                state.user = state.user || {};
                state.user.profession = custom || selected.dataset.value;
            }
            if (currentOnboardingStep === 2) {
                state.user.context = document.getElementById('user-context').value.trim();
            }
            if (currentOnboardingStep < 3) { currentOnboardingStep++; updateOnboardingUI(); }
        }

        function prevOnboardingStep() {
            if (currentOnboardingStep > 1) { currentOnboardingStep--; updateOnboardingUI(); }
        }

        function updateOnboardingUI() {
            document.querySelectorAll('.onboarding-step').forEach(step => {
                step.classList.toggle('active', parseInt(step.dataset.step) === currentOnboardingStep);
            });
            document.querySelectorAll('.step-dot').forEach(dot => {
                dot.classList.toggle('active', parseInt(dot.dataset.step) === currentOnboardingStep);
            });
        }

        function completeOnboarding() {
            const apiKey = document.getElementById('api-key-input').value.trim();
            if (!apiKey || !apiKey.startsWith('sk-')) { showToast('Ingresa una API key v√°lida'); return; }
            state.user.apiKey = apiKey;
            saveState();
            showScreen('main-screen');
            showToast('¬°Bienvenido a IdeaForge! üí°');
        }

        document.querySelectorAll('.profession-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.profession-option').forEach(o => o.classList.remove('selected'));
                option.classList.add('selected');
                document.getElementById('custom-profession').value = '';
            });
        });

        document.getElementById('custom-profession').addEventListener('input', function() {
            if (this.value.trim()) document.querySelectorAll('.profession-option').forEach(o => o.classList.remove('selected'));
        });

        // ==================== SCREEN NAVIGATION ====================
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.screen === screenId);
            });
            const showFab = ['main-screen', 'connections-screen'].includes(screenId);
            document.getElementById('fab-container').style.display = showFab ? 'block' : 'none';
            document.getElementById('bottom-nav').style.display = screenId === 'onboarding-screen' ? 'none' : 'flex';
            if (screenId === 'capture-screen') resetCaptureScreen();
            if (screenId === 'settings-screen') {
                document.getElementById('settings-profession').textContent = state.user?.profession || 'No configurado';
            }
            if ('vibrate' in navigator) navigator.vibrate(10);
        }

        // ==================== VOICE RECORDING ====================
        async function toggleRecording() {
            if (state.isRecording) stopRecording(); else startRecording();
        }

        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                state.mediaRecorder = new MediaRecorder(stream);
                state.audioChunks = [];
                state.mediaRecorder.ondataavailable = (e) => state.audioChunks.push(e.data);
                state.mediaRecorder.onstop = async () => {
                    const audioBlob = new Blob(state.audioChunks, { type: 'audio/webm' });
                    await transcribeAudio(audioBlob);
                    stream.getTracks().forEach(track => track.stop());
                };
                state.mediaRecorder.start();
                state.isRecording = true;
                state.recordingStartTime = Date.now();
                document.getElementById('voice-btn').classList.add('recording');
                document.getElementById('voice-btn-text').textContent = 'Detener';
                document.getElementById('recording-timer').classList.add('visible');
                state.recordingTimer = setInterval(updateRecordingTimer, 1000);
                if ('vibrate' in navigator) navigator.vibrate(50);
            } catch (error) {
                console.error('Error accessing microphone:', error);
                showToast('No se pudo acceder al micr√≥fono');
            }
        }

        function stopRecording() {
            if (state.mediaRecorder && state.isRecording) {
                state.mediaRecorder.stop();
                state.isRecording = false;
                document.getElementById('voice-btn').classList.remove('recording');
                document.getElementById('voice-btn-text').textContent = 'Grabar idea';
                document.getElementById('recording-timer').classList.remove('visible');
                clearInterval(state.recordingTimer);
                if ('vibrate' in navigator) navigator.vibrate([50, 50, 50]);
            }
        }

        function updateRecordingTimer() {
            const elapsed = Math.floor((Date.now() - state.recordingStartTime) / 1000);
            const m = Math.floor(elapsed / 60).toString().padStart(2, '0');
            const s = (elapsed % 60).toString().padStart(2, '0');
            document.getElementById('recording-timer').textContent = `${m}:${s}`;
        }

        async function transcribeAudio(audioBlob) {
            showToast('Transcribiendo...');
            const formData = new FormData();
            formData.append('file', audioBlob, 'recording.webm');
            formData.append('model', 'whisper-1');
            formData.append('language', 'es');
            try {
                const response = await fetch('https://api.openai.com/v1/audio/transcriptions', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${state.user.apiKey}` },
                    body: formData
                });
                if (!response.ok) throw new Error('Transcription failed');
                const data = await response.json();
                document.getElementById('capture-placeholder').style.display = 'none';
                const textArea = document.getElementById('capture-text');
                textArea.style.display = 'block';
                textArea.value = data.text;
                document.getElementById('capture-area').classList.add('has-content');
                document.getElementById('save-idea-btn').disabled = false;
                showToast('¬°Transcripci√≥n completada!');
            } catch (error) {
                console.error('Transcription error:', error);
                showToast('Error al transcribir. Intenta de nuevo.');
            }
        }

        // ==================== IDEA MANAGEMENT ====================
        async function saveIdea() {
            const content = document.getElementById('capture-text').value.trim();
            let title = document.getElementById('idea-title').value.trim();
            const selectedCategory = document.querySelector('.category-chip.selected');
            const category = selectedCategory?.dataset.category || 'otro';
            if (!content) { showToast('Escribe o graba tu idea primero'); return; }
            if (!title) { showToast('Generando t√≠tulo...'); title = await generateTitle(content); }
            const idea = {
                id: Date.now().toString(), title, content, category,
                createdAt: new Date().toISOString(), mentorFeedback: [], insights: null, roadmap: null
            };
            state.ideas.unshift(idea);
            saveState();
            showToast('¬°Idea guardada!');
            showScreen('main-screen');
            renderIdeas();
            updateStats();
        }

        async function generateTitle(content) {
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${state.user.apiKey}` },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [{ role: 'user', content: `Genera un t√≠tulo corto y memorable (m√°ximo 6 palabras) para esta idea. Solo responde con el t√≠tulo, sin comillas:\n\n${content}` }],
                        max_tokens: 30
                    })
                });
                const data = await response.json();
                return data.choices[0].message.content.trim();
            } catch (error) {
                return content.substring(0, 50) + '...';
            }
        }

        function renderIdeas(filter = 'all') {
            const grid = document.getElementById('ideas-grid');
            const filtered = filter === 'all' ? state.ideas : state.ideas.filter(i => i.category === filter);
            if (filtered.length === 0) {
                grid.innerHTML = `<div class="empty-state"><div class="icon">üí≠</div><h3>${filter === 'all' ? 'Tu primera idea te espera' : 'Sin ideas aqu√≠'}</h3><p>Presiona el micr√≥fono para capturar una idea</p></div>`;
                return;
            }
            grid.innerHTML = filtered.map(idea => {
                const cat = state.categories.find(c => c.id === idea.category) || { emoji: 'üí°', name: 'Otro', color: '#6b7280' };
                const date = new Date(idea.createdAt).toLocaleDateString('es', { day: 'numeric', month: 'short' });
                return `<div class="idea-card" data-category="${idea.category}" style="--category-color: ${cat.color}" onclick="viewIdea('${idea.id}')">
                    <div class="idea-card-header">
                        <span class="idea-category" style="--category-color: ${cat.color}; background: ${cat.color}20;">${cat.emoji} ${cat.name}</span>
                        <span class="idea-date">${date}</span>
                    </div>
                    <h3 class="idea-title">${idea.title}</h3>
                    <p class="idea-preview">${idea.content}</p>
                    ${idea.mentorFeedback.length > 0 ? `<div class="idea-meta"><span class="idea-meta-item">üß† ${idea.mentorFeedback.length} feedback${idea.mentorFeedback.length > 1 ? 's' : ''}</span></div>` : ''}
                </div>`;
            }).join('');
            renderFilters();
        }

        function renderFilters() {
            const container = document.getElementById('category-filters');
            const used = [...new Set(state.ideas.map(i => i.category))];
            let html = '<div class="filter-chip active" data-filter="all" onclick="filterIdeas(\'all\')">Todas</div>';
            used.forEach(catId => {
                const cat = state.categories.find(c => c.id === catId) || { emoji: 'üí°', name: 'Otro' };
                html += `<div class="filter-chip" data-filter="${catId}" onclick="filterIdeas('${catId}')">${cat.emoji} ${cat.name}</div>`;
            });
            container.innerHTML = html;
        }

        function filterIdeas(filter) {
            document.querySelectorAll('.filter-chip').forEach(c => c.classList.toggle('active', c.dataset.filter === filter));
            renderIdeas(filter);
        }

        function viewIdea(ideaId) {
            const idea = state.ideas.find(i => i.id === ideaId);
            if (!idea) return;
            state.currentIdea = idea;
            state.selectedMentor = null;
            const cat = state.categories.find(c => c.id === idea.category) || { emoji: 'üí°', name: 'Otro' };
            const date = new Date(idea.createdAt).toLocaleDateString('es', { day: 'numeric', month: 'long', year: 'numeric' });
            document.getElementById('detail-category').textContent = `${cat.emoji} ${cat.name}`;
            document.getElementById('detail-category').style.color = cat.color || 'var(--accent-primary)';
            document.getElementById('detail-title').textContent = idea.title;
            document.getElementById('detail-date').textContent = date;
            document.getElementById('detail-content').textContent = idea.content;
            document.querySelectorAll('.mentor-card').forEach(c => c.classList.remove('selected'));
            document.getElementById('consult-mentor-btn').style.display = 'none';
            document.getElementById('mentor-feedback').classList.remove('visible');
            showScreen('detail-screen');
        }

        function deleteIdea() {
            if (!state.currentIdea) return;
            if (confirm('¬øEliminar esta idea?')) {
                state.ideas = state.ideas.filter(i => i.id !== state.currentIdea.id);
                saveState();
                showToast('Idea eliminada');
                showScreen('main-screen');
                renderIdeas();
                updateStats();
            }
        }

        // ==================== CATEGORIES ====================
        function selectCategory(chip) {
            document.querySelectorAll('.category-chip:not(.add-new)').forEach(c => c.classList.remove('selected'));
            chip.classList.add('selected');
        }

        function showAddCategoryModal() { document.getElementById('category-modal').classList.add('visible'); }

        function addCategory() {
            const name = document.getElementById('new-category-name').value.trim();
            const emoji = document.getElementById('new-category-emoji').value.trim();
            if (!name) { showToast('Escribe un nombre'); return; }
            const id = name.toLowerCase().replace(/\s+/g, '-');
            const colors = ['#00d4aa', '#7c3aed', '#f59e0b', '#ec4899', '#3b82f6', '#10b981', '#f97316'];
            const color = colors[state.categories.length % colors.length];
            state.categories.push({ id, name, emoji: emoji || 'üìå', color });
            saveState();
            const container = document.getElementById('category-chips');
            const addBtn = container.querySelector('.add-new');
            const newChip = document.createElement('div');
            newChip.className = 'category-chip';
            newChip.dataset.category = id;
            newChip.style.cssText = `--category-color: ${color}`;
            newChip.textContent = `${emoji || 'üìå'} ${name}`;
            newChip.addEventListener('click', () => selectCategory(newChip));
            container.insertBefore(newChip, addBtn);
            closeModal('category-modal');
            document.getElementById('new-category-name').value = '';
            document.getElementById('new-category-emoji').value = '';
            showToast('Categor√≠a creada');
        }

        // ==================== MENTORS ====================
        function selectMentor(mentorId) {
            state.selectedMentor = mentorId;
            document.querySelectorAll('.mentor-card').forEach(c => c.classList.toggle('selected', c.dataset.mentor === mentorId));
            document.getElementById('consult-mentor-btn').style.display = 'block';
            document.getElementById('mentor-feedback').classList.remove('visible');
        }

        async function consultMentor() {
            if (!state.selectedMentor || !state.currentIdea) return;
            const mentor = MENTORS[state.selectedMentor];
            const btn = document.getElementById('consult-mentor-btn');
            btn.disabled = true;
            btn.textContent = 'Consultando...';
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${state.user.apiKey}` },
                    body: JSON.stringify({
                        model: 'gpt-4o',
                        messages: [
                            { role: 'system', content: `${mentor.prompt}\n\nContexto del creador: ${state.user.profession}. ${state.user.context || ''}` },
                            { role: 'user', content: `Idea: "${state.currentIdea.title}"\n\n${state.currentIdea.content}` }
                        ],
                        max_tokens: 500
                    })
                });
                const data = await response.json();
                const feedback = data.choices[0].message.content;
                state.currentIdea.mentorFeedback.push({ mentor: state.selectedMentor, feedback, date: new Date().toISOString() });
                saveState();
                document.getElementById('feedback-avatar').textContent = mentor.avatar;
                document.getElementById('feedback-name').textContent = mentor.name;
                document.getElementById('feedback-role').textContent = mentor.role;
                document.getElementById('feedback-content').textContent = feedback;
                document.getElementById('mentor-feedback').classList.add('visible');
            } catch (error) {
                console.error('Mentor error:', error);
                showToast('Error al consultar al mentor');
            }
            btn.disabled = false;
            btn.textContent = 'Consultar Mentor';
        }

        // ==================== INSIGHTS & ROADMAP ====================
        async function showInsights() {
            if (!state.currentIdea) return;
            document.getElementById('insights-modal').classList.add('visible');
            document.getElementById('insights-content').innerHTML = '<div class="loading"><div class="loading-spinner"></div><span>Analizando...</span></div>';
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${state.user.apiKey}` },
                    body: JSON.stringify({
                        model: 'gpt-4o',
                        messages: [
                            { role: 'system', content: `Genera insights profundos: üíé Valor √∫nico, üéØ P√∫blico ideal, ‚ö†Ô∏è Riesgo principal, üöÄ Oportunidad no obvia, üí° Pregunta poderosa. S√© conciso. Espa√±ol.` },
                            { role: 'user', content: `Soy ${state.user.profession}. ${state.user.context || ''}\n\nIdea: "${state.currentIdea.title}"\n${state.currentIdea.content}` }
                        ],
                        max_tokens: 600
                    })
                });
                const data = await response.json();
                document.getElementById('insights-content').innerHTML = `<div style="white-space: pre-wrap; line-height: 1.7; color: var(--text-secondary);">${data.choices[0].message.content}</div>`;
            } catch (error) {
                document.getElementById('insights-content').innerHTML = '<p style="color: var(--accent-danger);">Error. Intenta de nuevo.</p>';
            }
        }

        async function showRoadmap() {
            if (!state.currentIdea) return;
            document.getElementById('roadmap-modal').classList.add('visible');
            document.getElementById('roadmap-content').innerHTML = '<div class="loading"><div class="loading-spinner"></div><span>Creando roadmap...</span></div>';
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${state.user.apiKey}` },
                    body: JSON.stringify({
                        model: 'gpt-4o',
                        messages: [
                            { role: 'system', content: `Crea roadmap pr√°ctico: üìÖ SEMANA 1, üìÖ SEMANA 2-4, üìÖ MES 2-3, üí∞ Inversi√≥n estimada, ‚è±Ô∏è Tiempo hasta MVP. S√© realista y espec√≠fico. Espa√±ol.` },
                            { role: 'user', content: `Soy ${state.user.profession}. ${state.user.context || ''}\n\nIdea: "${state.currentIdea.title}"\n${state.currentIdea.content}` }
                        ],
                        max_tokens: 800
                    })
                });
                const data = await response.json();
                document.getElementById('roadmap-content').innerHTML = `<div style="white-space: pre-wrap; line-height: 1.7; color: var(--text-secondary);">${data.choices[0].message.content}</div>`;
            } catch (error) {
                document.getElementById('roadmap-content').innerHTML = '<p style="color: var(--accent-danger);">Error. Intenta de nuevo.</p>';
            }
        }

        // ==================== CONNECTIONS ====================
        async function findConnections() {
            if (state.ideas.length < 3) { showToast('Necesitas al menos 3 ideas'); return; }
            const btn = document.getElementById('find-connections-btn');
            btn.disabled = true;
            btn.textContent = 'üîç Buscando...';
            const summary = state.ideas.map(i => `- ${i.title}: ${i.content.substring(0, 100)}`).join('\n');
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${state.user.apiKey}` },
                    body: JSON.stringify({
                        model: 'gpt-4o',
                        messages: [
                            { role: 'system', content: `Encuentra 2-3 grupos de ideas conectadas. JSON: {"connections":[{"theme":"...","ideas":["t√≠tulo1","t√≠tulo2"],"insight":"c√≥mo combinar..."}]}. Solo JSON.` },
                            { role: 'user', content: `Mis ideas:\n${summary}` }
                        ],
                        max_tokens: 800
                    })
                });
                const data = await response.json();
                const content = data.choices[0].message.content.replace(/```json\n?|\n?```/g, '');
                state.connections = JSON.parse(content).connections;
                saveState();
                renderConnections();
                updateStats();
            } catch (error) {
                showToast('Error al buscar conexiones');
            }
            btn.disabled = false;
            btn.textContent = 'üîç Buscar Conexiones';
        }

        function renderConnections() {
            const container = document.getElementById('connections-list');
            if (!state.connections || state.connections.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="icon">üîó</div><h3>A√∫n no hay conexiones</h3><p>Presiona buscar para encontrar patrones</p></div>';
                return;
            }
            container.innerHTML = state.connections.map(conn => `
                <div class="connection-group">
                    <div class="connection-theme"><span>üîó</span> ${conn.theme}</div>
                    <div class="connection-ideas">
                        ${conn.ideas.map(title => {
                            const idea = state.ideas.find(i => i.title === title);
                            return idea ? `<div class="connection-idea" onclick="viewIdea('${idea.id}')">${title}</div>` : `<div class="connection-idea">${title}</div>`;
                        }).join('')}
                    </div>
                    <div class="connection-insight">üí° ${conn.insight}</div>
                </div>
            `).join('');
        }

        // ==================== SETTINGS ====================
        function updateStats() {
            document.getElementById('total-ideas').textContent = state.ideas.length;
            document.getElementById('total-categories').textContent = [...new Set(state.ideas.map(i => i.category))].length;
            document.getElementById('total-connections').textContent = state.connections?.length || 0;
        }

        function exportData() {
            const data = { user: state.user, ideas: state.ideas, categories: state.categories, connections: state.connections, exportedAt: new Date().toISOString() };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `ideaforge-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            showToast('Backup exportado');
        }

        function importData() { document.getElementById('import-file').click(); }

        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.ideas && data.user) {
                        state.user = data.user;
                        state.ideas = data.ideas;
                        state.categories = data.categories || state.categories;
                        state.connections = data.connections || [];
                        saveState();
                        renderIdeas();
                        updateStats();
                        showToast('Datos importados');
                    } else { showToast('Archivo inv√°lido'); }
                } catch (error) { showToast('Error al leer archivo'); }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function clearAllData() {
            if (confirm('¬øEliminar TODOS los datos?')) {
                if (confirm('¬øSeguro? Se perder√°n todas tus ideas.')) {
                    localStorage.removeItem('ideaforge-state');
                    location.reload();
                }
            }
        }

        function showEditProfile() {
            const newProf = prompt('Tu profesi√≥n:', state.user?.profession || '');
            if (newProf !== null) {
                state.user.profession = newProf;
                const newCtx = prompt('Contexto adicional:', state.user?.context || '');
                if (newCtx !== null) state.user.context = newCtx;
                saveState();
                document.getElementById('settings-profession').textContent = state.user.profession;
                showToast('Perfil actualizado');
            }
        }

        function showEditApiKey() {
            const newKey = prompt('Nueva API Key:', '');
            if (newKey && newKey.startsWith('sk-')) { state.user.apiKey = newKey; saveState(); showToast('API Key actualizada'); }
            else if (newKey) showToast('API Key inv√°lida');
        }

        // ==================== UTILITIES ====================
        function resetCaptureScreen() {
            document.getElementById('capture-placeholder').style.display = 'flex';
            document.getElementById('capture-text').style.display = 'none';
            document.getElementById('capture-text').value = '';
            document.getElementById('capture-area').classList.remove('has-content');
            document.getElementById('idea-title').value = '';
            document.getElementById('save-idea-btn').disabled = true;
            document.querySelectorAll('.category-chip').forEach(c => c.classList.remove('selected'));
            if (state.isRecording) stopRecording();
        }

        function showSearch() {
            const q = prompt('Buscar ideas:');
            if (q && q.trim()) {
                const results = state.ideas.filter(i => i.title.toLowerCase().includes(q.toLowerCase()) || i.content.toLowerCase().includes(q.toLowerCase()));
                if (results.length === 0) showToast('No encontrado');
                else if (results.length === 1) viewIdea(results[0].id);
                else { renderIdeas('all'); showToast(`${results.length} resultados`); }
            }
        }

        function editIdea() {
            if (!state.currentIdea) return;
            const newContent = prompt('Editar idea:', state.currentIdea.content);
            if (newContent !== null && newContent.trim()) {
                state.currentIdea.content = newContent.trim();
                const newTitle = prompt('Editar t√≠tulo:', state.currentIdea.title);
                if (newTitle !== null && newTitle.trim()) state.currentIdea.title = newTitle.trim();
                saveState();
                document.getElementById('detail-title').textContent = state.currentIdea.title;
                document.getElementById('detail-content').textContent = state.currentIdea.content;
                showToast('Idea actualizada');
            }
        }

        function closeModal(id) { document.getElementById(id).classList.remove('visible'); }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.add('visible');
            setTimeout(() => toast.classList.remove('visible'), 2500);
        }

        document.querySelectorAll('.modal-overlay').forEach(o => {
            o.addEventListener('click', (e) => { if (e.target === o) o.classList.remove('visible'); });
        });

        init();
    </script>
</body>
</html>
