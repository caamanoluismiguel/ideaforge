<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a0a0f">
<title>IdeaForge</title>
<link rel="manifest" href="manifest.json">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
    --bg-primary: #0a0a0f;
    --bg-secondary: #111116;
    --bg-tertiary: #1a1a22;
    --bg-elevated: #222230;
    --accent: #00d4aa;
    --accent-dim: rgba(0, 212, 170, 0.12);
    --accent-glow: rgba(0, 212, 170, 0.4);
    --secondary: #7c3aed;
    --secondary-dim: rgba(124, 58, 237, 0.12);
    --danger: #ef4444;
    --danger-dim: rgba(239, 68, 68, 0.12);
    --text-primary: #ffffff;
    --text-secondary: #a0a0b0;
    --text-muted: #606070;
    --border: rgba(255, 255, 255, 0.08);
    --border-active: rgba(255, 255, 255, 0.16);
    --safe-top: env(safe-area-inset-top, 0px);
    --safe-bottom: env(safe-area-inset-bottom, 0px);
    --nav-height: 72px;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
}

html, body {
    height: 100%;
    overflow: hidden;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.5;
    -webkit-font-smoothing: antialiased;
}

/* ========== SCREEN SYSTEM ========== */
.app-container {
    position: fixed;
    inset: 0;
    display: flex;
    flex-direction: column;
}

.screen {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.35s ease, visibility 0.35s ease;
    background: var(--bg-primary);
    z-index: 1;
}

.screen.active {
    opacity: 1;
    visibility: visible;
    z-index: 10;
}

.screen-content {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    -webkit-overflow-scrolling: touch;
    padding: 24px;
    padding-top: calc(24px + var(--safe-top));
}

.screen-content.with-nav {
    padding-bottom: calc(140px + var(--safe-bottom));
}

/* ========== ONBOARDING ========== */
#onboarding {
    background: var(--bg-primary);
    z-index: 1000;
}

#onboarding::before {
    content: '';
    position: absolute;
    top: -30%;
    left: -30%;
    width: 160%;
    height: 160%;
    background: 
        radial-gradient(ellipse at 30% 20%, rgba(0, 212, 170, 0.08) 0%, transparent 50%),
        radial-gradient(ellipse at 70% 80%, rgba(124, 58, 237, 0.08) 0%, transparent 50%);
    pointer-events: none;
}

.onboarding-content {
    position: relative;
    z-index: 1;
    min-height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 40px 24px;
    padding-top: calc(40px + var(--safe-top));
    padding-bottom: calc(40px + var(--safe-bottom));
}

.brand {
    text-align: center;
    margin-bottom: 48px;
}

.brand-logo {
    width: 96px;
    height: 96px;
    margin: 0 auto 24px;
    background: linear-gradient(135deg, var(--accent-dim), var(--secondary-dim));
    border-radius: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 48px;
    box-shadow: 0 20px 60px rgba(0, 212, 170, 0.2);
    animation: float 4s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
}

.brand-name {
    font-size: 36px;
    font-weight: 700;
    letter-spacing: -0.02em;
    background: linear-gradient(135deg, var(--accent), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.brand-tagline {
    font-size: 16px;
    color: var(--text-secondary);
    margin-top: 8px;
}

.step-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 32px 24px;
}

.step-progress {
    display: flex;
    gap: 8px;
    margin-bottom: 32px;
}

.step-progress-bar {
    flex: 1;
    height: 3px;
    background: var(--bg-tertiary);
    border-radius: 2px;
    overflow: hidden;
}

.step-progress-bar.complete {
    background: var(--accent);
}

.step-progress-bar.active {
    background: linear-gradient(90deg, var(--accent) 50%, var(--bg-tertiary) 50%);
}

.step {
    display: none;
    animation: stepIn 0.4s ease;
}

.step.active {
    display: block;
}

@keyframes stepIn {
    from { opacity: 0; transform: translateX(20px); }
    to { opacity: 1; transform: translateX(0); }
}

.step-header {
    margin-bottom: 24px;
}

.step-title {
    font-size: 22px;
    font-weight: 600;
    margin-bottom: 8px;
}

.step-desc {
    font-size: 14px;
    color: var(--text-secondary);
    line-height: 1.6;
}

.options-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 24px;
}

.option {
    padding: 20px 16px;
    background: var(--bg-tertiary);
    border: 2px solid transparent;
    border-radius: 16px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.option:active {
    transform: scale(0.97);
}

.option.selected {
    border-color: var(--accent);
    background: var(--accent-dim);
}

.option-icon {
    font-size: 32px;
    margin-bottom: 10px;
}

.option-label {
    font-size: 13px;
    font-weight: 500;
}

.input-field {
    width: 100%;
    padding: 18px 20px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border);
    border-radius: 14px;
    color: var(--text-primary);
    font-family: inherit;
    font-size: 16px;
    transition: all 0.2s ease;
    margin-bottom: 16px;
}

.input-field:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 4px var(--accent-dim);
}

.input-field::placeholder {
    color: var(--text-muted);
}

textarea.input-field {
    resize: none;
    min-height: 120px;
    line-height: 1.6;
}

.input-hint {
    font-size: 13px;
    color: var(--text-muted);
    margin-top: -8px;
    margin-bottom: 16px;
}

.input-hint a {
    color: var(--accent);
    text-decoration: none;
}

.btn-row {
    display: flex;
    gap: 12px;
    margin-top: 8px;
}

.btn {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 16px 24px;
    border: none;
    border-radius: 14px;
    font-family: inherit;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn:active {
    transform: scale(0.97);
}

.btn-primary {
    background: linear-gradient(135deg, var(--accent), #00b894);
    color: var(--bg-primary);
    box-shadow: 0 8px 32px var(--accent-glow);
}

.btn-primary:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    box-shadow: none;
}

.btn-secondary {
    background: var(--bg-tertiary);
    color: var(--text-primary);
    border: 1px solid var(--border);
}

.btn-ghost {
    background: transparent;
    color: var(--text-secondary);
}

.btn-full {
    width: 100%;
}

/* ========== MAIN SCREEN ========== */
.header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 28px;
}

.header-title {
    font-size: 32px;
    font-weight: 700;
    letter-spacing: -0.02em;
}

.header-actions {
    display: flex;
    gap: 8px;
}

.icon-btn {
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 12px;
    color: var(--text-secondary);
    font-size: 18px;
    cursor: pointer;
    transition: all 0.2s;
}

.icon-btn:active {
    transform: scale(0.95);
    background: var(--bg-tertiary);
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-bottom: 28px;
}

.stat-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 18px;
    text-align: center;
}

.stat-value {
    font-size: 28px;
    font-weight: 700;
    background: linear-gradient(135deg, var(--accent), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.stat-label {
    font-size: 11px;
    font-weight: 500;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.06em;
    margin-top: 4px;
}

.filter-scroll {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    padding-bottom: 4px;
    margin-bottom: 20px;
    scrollbar-width: none;
}

.filter-scroll::-webkit-scrollbar {
    display: none;
}

.filter-chip {
    flex-shrink: 0;
    padding: 10px 20px;
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 100px;
    font-size: 13px;
    font-weight: 500;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
}

.filter-chip:active {
    transform: scale(0.96);
}

.filter-chip.active {
    background: var(--accent);
    border-color: var(--accent);
    color: var(--bg-primary);
}

.ideas-list {
    display: flex;
    flex-direction: column;
    gap: 14px;
}

.idea-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 18px;
    padding: 20px;
    position: relative;
    cursor: pointer;
    transition: all 0.2s;
    overflow: hidden;
}

.idea-card:active {
    transform: scale(0.985);
    background: var(--bg-tertiary);
}

.idea-card-accent {
    position: absolute;
    top: 20px;
    bottom: 20px;
    left: 0;
    width: 3px;
    border-radius: 0 4px 4px 0;
}

.idea-card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;
    padding-left: 14px;
}

.idea-badge {
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    padding: 6px 12px;
    border-radius: 100px;
}

.idea-date {
    font-size: 12px;
    color: var(--text-muted);
}

.idea-title {
    font-size: 17px;
    font-weight: 600;
    margin-bottom: 8px;
    padding-left: 14px;
    line-height: 1.4;
}

.idea-preview {
    font-size: 14px;
    color: var(--text-secondary);
    line-height: 1.6;
    padding-left: 14px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.idea-footer {
    display: flex;
    gap: 16px;
    margin-top: 14px;
    padding-top: 14px;
    padding-left: 14px;
    border-top: 1px solid var(--border);
}

.idea-meta {
    font-size: 12px;
    color: var(--text-muted);
    display: flex;
    align-items: center;
    gap: 6px;
}

.empty-state {
    text-align: center;
    padding: 60px 20px;
}

.empty-icon {
    font-size: 64px;
    margin-bottom: 20px;
    opacity: 0.6;
}

.empty-title {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 8px;
}

.empty-desc {
    font-size: 14px;
    color: var(--text-secondary);
    line-height: 1.6;
}

/* ========== FAB ========== */
.fab-container {
    position: fixed;
    bottom: calc(var(--nav-height) + 24px + var(--safe-bottom));
    left: 50%;
    transform: translateX(-50%);
    z-index: 100;
}

.fab {
    width: 64px;
    height: 64px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent), #00b894);
    border: none;
    color: var(--bg-primary);
    font-size: 26px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 8px 32px var(--accent-glow);
    transition: all 0.2s;
}

.fab:active {
    transform: scale(0.92);
}

.fab.recording {
    background: linear-gradient(135deg, var(--danger), #dc2626);
    box-shadow: 0 8px 32px rgba(239, 68, 68, 0.5);
    animation: pulse 1s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.08); }
}

/* ========== RECORDING INDICATOR ========== */
.recording-indicator {
    position: fixed;
    bottom: calc(var(--nav-height) + 100px + var(--safe-bottom));
    left: 50%;
    transform: translateX(-50%);
    background: var(--bg-secondary);
    border: 1px solid var(--danger);
    padding: 12px 28px;
    border-radius: 100px;
    display: none;
    align-items: center;
    gap: 14px;
    z-index: 100;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
}

.recording-indicator.visible {
    display: flex;
    animation: slideUp 0.3s ease;
}

@keyframes slideUp {
    from { opacity: 0; transform: translateX(-50%) translateY(20px); }
    to { opacity: 1; transform: translateX(-50%) translateY(0); }
}

.recording-dot {
    width: 12px;
    height: 12px;
    background: var(--danger);
    border-radius: 50%;
    animation: blink 1s infinite;
}

@keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
}

.recording-time {
    font-size: 18px;
    font-weight: 600;
    color: var(--danger);
    font-variant-numeric: tabular-nums;
}

/* ========== BOTTOM NAV ========== */
.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: calc(var(--nav-height) + var(--safe-bottom));
    background: rgba(10, 10, 15, 0.95);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-top: 1px solid var(--border);
    display: flex;
    justify-content: space-around;
    align-items: flex-start;
    padding-top: 12px;
    z-index: 90;
}

.nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    padding: 8px 24px;
    background: none;
    border: none;
    color: var(--text-muted);
    font-family: inherit;
    font-size: 11px;
    font-weight: 500;
    cursor: pointer;
    transition: color 0.2s;
}

.nav-item.active {
    color: var(--accent);
}

.nav-icon {
    font-size: 22px;
}

/* ========== CAPTURE SCREEN ========== */
.capture-header {
    text-align: center;
    margin-bottom: 32px;
}

.capture-title {
    font-size: 26px;
    font-weight: 700;
    margin-bottom: 8px;
}

.capture-subtitle {
    font-size: 15px;
    color: var(--text-secondary);
}

.capture-area {
    background: var(--bg-secondary);
    border: 2px dashed var(--border);
    border-radius: 24px;
    padding: 32px 24px;
    min-height: 200px;
    display: flex;
    flex-direction: column;
    transition: all 0.3s ease;
    margin-bottom: 20px;
}

.capture-area.has-content {
    border-style: solid;
    border-color: var(--accent);
}

.capture-area.recording {
    border-color: var(--danger);
    background: var(--danger-dim);
}

.capture-placeholder {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: var(--text-muted);
}

.capture-placeholder-icon {
    font-size: 56px;
    margin-bottom: 16px;
    opacity: 0.5;
}

.capture-placeholder-text {
    font-size: 15px;
    line-height: 1.6;
}

.capture-textarea {
    flex: 1;
    background: transparent;
    border: none;
    color: var(--text-primary);
    font-family: inherit;
    font-size: 17px;
    line-height: 1.7;
    resize: none;
    min-height: 160px;
}

.capture-textarea:focus {
    outline: none;
}

.capture-textarea::placeholder {
    color: var(--text-muted);
}

.voice-btn {
    width: 100%;
    padding: 18px;
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 16px;
    color: var(--text-primary);
    font-family: inherit;
    font-size: 15px;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    transition: all 0.2s;
    margin-bottom: 28px;
}

.voice-btn:active {
    transform: scale(0.98);
}

.voice-btn.recording {
    background: var(--danger-dim);
    border-color: var(--danger);
    color: var(--danger);
}

.voice-btn-icon {
    font-size: 22px;
}

.form-section {
    margin-bottom: 24px;
}

.form-label {
    font-size: 12px;
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-bottom: 12px;
}

.category-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.category-chip {
    padding: 12px 20px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border);
    border-radius: 100px;
    font-size: 14px;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 8px;
}

.category-chip:active {
    transform: scale(0.95);
}

.category-chip.selected {
    background: var(--accent);
    border-color: var(--accent);
    color: var(--bg-primary);
    font-weight: 500;
}

.category-chip.add {
    border-style: dashed;
    color: var(--text-muted);
}

/* ========== DETAIL SCREEN ========== */
.detail-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.back-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    background: none;
    border: none;
    color: var(--text-secondary);
    font-family: inherit;
    font-size: 15px;
    cursor: pointer;
    padding: 8px 0;
}

.detail-badge {
    display: inline-block;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    padding: 8px 16px;
    border-radius: 100px;
    margin-bottom: 16px;
}

.detail-title {
    font-size: 28px;
    font-weight: 700;
    line-height: 1.3;
    margin-bottom: 12px;
}

.detail-meta {
    font-size: 13px;
    color: var(--text-muted);
}

.detail-content {
    font-size: 17px;
    line-height: 1.8;
    color: var(--text-secondary);
    margin: 28px 0;
    padding: 24px;
    background: var(--bg-secondary);
    border-radius: 18px;
    border: 1px solid var(--border);
}

.action-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 36px;
}

.action-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
}

.action-card:active {
    transform: scale(0.97);
    background: var(--bg-tertiary);
}

.action-icon {
    font-size: 28px;
    margin-bottom: 10px;
}

.action-label {
    font-size: 13px;
    font-weight: 500;
    color: var(--text-secondary);
}

/* ========== MENTORS SECTION ========== */
.section-header {
    margin-bottom: 16px;
}

.section-title {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 6px;
}

.section-desc {
    font-size: 14px;
    color: var(--text-muted);
}

.mentor-scroll {
    display: flex;
    gap: 12px;
    overflow-x: auto;
    padding-bottom: 8px;
    margin-bottom: 16px;
    scrollbar-width: none;
}

.mentor-scroll::-webkit-scrollbar {
    display: none;
}

.mentor-card {
    flex-shrink: 0;
    width: 120px;
    background: var(--bg-secondary);
    border: 2px solid var(--border);
    border-radius: 16px;
    padding: 20px 14px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
}

.mentor-card:active {
    transform: scale(0.96);
}

.mentor-card.selected {
    border-color: var(--secondary);
    background: var(--secondary-dim);
}

.mentor-avatar {
    font-size: 40px;
    margin-bottom: 12px;
}

.mentor-name {
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 4px;
}

.mentor-role {
    font-size: 11px;
    color: var(--text-muted);
    line-height: 1.4;
}

.mentor-action-panel {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 18px;
    padding: 24px;
    display: none;
    animation: fadeIn 0.3s ease;
}

.mentor-action-panel.visible {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.mentor-selected-header {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 20px;
}

.mentor-selected-avatar {
    font-size: 36px;
}

.mentor-selected-name {
    font-size: 17px;
    font-weight: 600;
    margin-bottom: 2px;
}

.mentor-selected-role {
    font-size: 13px;
    color: var(--text-muted);
}

.mentor-feedback {
    background: var(--bg-tertiary);
    border-radius: 14px;
    padding: 20px;
    margin-top: 20px;
    display: none;
    animation: fadeIn 0.3s ease;
}

.mentor-feedback.visible {
    display: block;
}

.mentor-feedback-text {
    font-size: 15px;
    line-height: 1.8;
    color: var(--text-secondary);
    white-space: pre-wrap;
}

/* ========== CONNECTIONS SCREEN ========== */
.connections-intro {
    text-align: center;
    margin-bottom: 28px;
}

.connection-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 18px;
    padding: 24px;
    margin-bottom: 16px;
}

.connection-theme {
    font-size: 15px;
    font-weight: 600;
    color: var(--secondary);
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.connection-ideas {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.connection-idea-item {
    background: var(--bg-tertiary);
    border-radius: 12px;
    padding: 14px 16px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s;
}

.connection-idea-item:active {
    background: var(--bg-elevated);
}

.connection-insight {
    margin-top: 18px;
    padding-top: 18px;
    border-top: 1px solid var(--border);
    font-size: 14px;
    color: var(--text-secondary);
    line-height: 1.6;
}

/* ========== SETTINGS SCREEN ========== */
.settings-section {
    margin-bottom: 32px;
}

.settings-section-title {
    font-size: 12px;
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-bottom: 12px;
    padding-left: 4px;
}

.settings-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 18px;
    overflow: hidden;
}

.settings-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 18px 20px;
    cursor: pointer;
    transition: background 0.2s;
    border-bottom: 1px solid var(--border);
}

.settings-item:last-child {
    border-bottom: none;
}

.settings-item:active {
    background: var(--bg-tertiary);
}

.settings-item-left {
    display: flex;
    align-items: center;
    gap: 16px;
}

.settings-item-icon {
    font-size: 20px;
    width: 28px;
    text-align: center;
}

.settings-item-label {
    font-size: 15px;
}

.settings-item-value {
    font-size: 14px;
    color: var(--text-muted);
}

.settings-item.danger .settings-item-label {
    color: var(--danger);
}

.api-display {
    font-size: 13px;
    color: var(--text-muted);
    background: var(--bg-tertiary);
    padding: 8px 14px;
    border-radius: 8px;
    font-family: monospace;
}

/* ========== MODALS ========== */
.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.8);
    display: none;
    align-items: flex-end;
    justify-content: center;
    z-index: 500;
    padding: 20px;
}

.modal-overlay.visible {
    display: flex;
    animation: fadeIn 0.2s ease;
}

.modal {
    background: var(--bg-secondary);
    border-radius: 24px 24px 0 0;
    padding: 28px 24px;
    padding-bottom: calc(28px + var(--safe-bottom));
    width: 100%;
    max-width: 500px;
    max-height: 85vh;
    overflow-y: auto;
    animation: modalSlide 0.3s ease;
}

@keyframes modalSlide {
    from { transform: translateY(100%); }
    to { transform: translateY(0); }
}

.modal-handle {
    width: 40px;
    height: 4px;
    background: var(--border);
    border-radius: 2px;
    margin: 0 auto 24px;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.modal-title {
    font-size: 20px;
    font-weight: 600;
}

.modal-close {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg-tertiary);
    border: none;
    border-radius: 50%;
    color: var(--text-secondary);
    font-size: 20px;
    cursor: pointer;
}

.modal-content {
    font-size: 15px;
    line-height: 1.8;
    color: var(--text-secondary);
    white-space: pre-wrap;
}

/* ========== LOADING ========== */
.loading-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 16px;
    padding: 48px 20px;
}

.spinner {
    width: 36px;
    height: 36px;
    border: 3px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.loading-text {
    font-size: 14px;
    color: var(--text-muted);
}

/* ========== TOAST ========== */
.toast {
    position: fixed;
    bottom: calc(var(--nav-height) + 90px + var(--safe-bottom));
    left: 50%;
    transform: translateX(-50%) translateY(30px);
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    color: var(--text-primary);
    padding: 16px 28px;
    border-radius: 100px;
    font-size: 14px;
    font-weight: 500;
    z-index: 600;
    opacity: 0;
    pointer-events: none;
    transition: all 0.3s ease;
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5);
}

.toast.visible {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
    pointer-events: auto;
}

.toast.success {
    border-color: var(--accent);
}

.toast.error {
    border-color: var(--danger);
}

/* ========== UTILITIES ========== */
.hidden {
    display: none !important;
}
</style>
</head>
<body>
<div class="app-container">
    <!-- ONBOARDING SCREEN -->
    <div id="onboarding" class="screen active">
        <div class="onboarding-content">
            <div class="brand">
                <div class="brand-logo">üí°</div>
                <h1 class="brand-name">IdeaForge</h1>
                <p class="brand-tagline" data-t="tagline"></p>
            </div>
            
            <div class="step-card">
                <div class="step-progress">
                    <div class="step-progress-bar complete" data-step="1"></div>
                    <div class="step-progress-bar" data-step="2"></div>
                    <div class="step-progress-bar" data-step="3"></div>
                    <div class="step-progress-bar" data-step="4"></div>
                </div>
                
                <!-- Step 1: Language -->
                <div class="step active" data-step="1">
                    <div class="step-header">
                        <h2 class="step-title">Choose your language</h2>
                        <p class="step-desc">Select your preferred language for the app</p>
                    </div>
                    <div class="options-grid">
                        <div class="option selected" data-lang="en">
                            <div class="option-icon">üá∫üá∏</div>
                            <div class="option-label">English</div>
                        </div>
                        <div class="option" data-lang="es">
                            <div class="option-icon">üá™üá∏</div>
                            <div class="option-label">Espa√±ol</div>
                        </div>
                    </div>
                    <button class="btn btn-primary btn-full" onclick="nextStep()" data-t="continue"></button>
                </div>
                
                <!-- Step 2: Profession -->
                <div class="step" data-step="2">
                    <div class="step-header">
                        <h2 class="step-title" data-t="step2.title"></h2>
                        <p class="step-desc" data-t="step2.desc"></p>
                    </div>
                    <div class="options-grid" id="professionGrid">
                        <div class="option" data-prof="entrepreneur"><div class="option-icon">üöÄ</div><div class="option-label" data-t="prof.entrepreneur"></div></div>
                        <div class="option" data-prof="creative"><div class="option-icon">üé®</div><div class="option-label" data-t="prof.creative"></div></div>
                        <div class="option" data-prof="developer"><div class="option-icon">üíª</div><div class="option-label" data-t="prof.developer"></div></div>
                        <div class="option" data-prof="consultant"><div class="option-icon">üìä</div><div class="option-label" data-t="prof.consultant"></div></div>
                        <div class="option" data-prof="academic"><div class="option-icon">üìö</div><div class="option-label" data-t="prof.academic"></div></div>
                        <div class="option" data-prof="marketing"><div class="option-icon">üì¢</div><div class="option-label" data-t="prof.marketing"></div></div>
                    </div>
                    <input type="text" class="input-field" id="customProfession" data-tp="step2.custom">
                    <div class="btn-row">
                        <button class="btn btn-secondary" onclick="prevStep()" data-t="back"></button>
                        <button class="btn btn-primary" onclick="nextStep()" data-t="continue"></button>
                    </div>
                </div>
                
                <!-- Step 3: Context -->
                <div class="step" data-step="3">
                    <div class="step-header">
                        <h2 class="step-title" data-t="step3.title"></h2>
                        <p class="step-desc" data-t="step3.desc"></p>
                    </div>
                    <textarea class="input-field" id="userContext" data-tp="step3.placeholder"></textarea>
                    <div class="btn-row">
                        <button class="btn btn-secondary" onclick="prevStep()" data-t="back"></button>
                        <button class="btn btn-primary" onclick="nextStep()" data-t="continue"></button>
                    </div>
                </div>
                
                <!-- Step 4: API Key -->
                <div class="step" data-step="4">
                    <div class="step-header">
                        <h2 class="step-title" data-t="step4.title"></h2>
                        <p class="step-desc" data-t="step4.desc"></p>
                    </div>
                    <input type="password" class="input-field" id="apiKeyInput" placeholder="sk-...">
                    <p class="input-hint"><span data-t="step4.hint"></span> <a href="https://platform.openai.com/api-keys" target="_blank">platform.openai.com</a></p>
                    <div class="btn-row">
                        <button class="btn btn-secondary" onclick="prevStep()" data-t="back"></button>
                        <button class="btn btn-primary" onclick="completeOnboarding()" data-t="start"></button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- MAIN SCREEN -->
    <div id="main" class="screen">
        <div class="screen-content with-nav">
            <div class="header">
                <h1 class="header-title" data-t="ideas"></h1>
                <div class="header-actions">
                    <button class="icon-btn" onclick="searchIdeas()">üîç</button>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="statIdeas">0</div>
                    <div class="stat-label" data-t="stat.ideas"></div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statCategories">0</div>
                    <div class="stat-label" data-t="stat.categories"></div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statFeedback">0</div>
                    <div class="stat-label" data-t="stat.feedback"></div>
                </div>
            </div>
            
            <div class="filter-scroll" id="filterContainer"></div>
            <div class="ideas-list" id="ideasList"></div>
        </div>
    </div>
    
    <!-- CAPTURE SCREEN -->
    <div id="capture" class="screen">
        <div class="screen-content">
            <button class="back-btn" onclick="navigateTo('main')">‚Üê <span data-t="cancel"></span></button>
            
            <div class="capture-header">
                <h1 class="capture-title" data-t="newIdea"></h1>
                <p class="capture-subtitle" data-t="newIdeaDesc"></p>
            </div>
            
            <div class="capture-area" id="captureArea">
                <div class="capture-placeholder" id="capturePlaceholder">
                    <div class="capture-placeholder-icon">üé§</div>
                    <p class="capture-placeholder-text" data-t="capturePlaceholder"></p>
                </div>
                <textarea class="capture-textarea hidden" id="captureTextarea" data-tp="captureTextareaPlaceholder"></textarea>
            </div>
            
            <button class="voice-btn" id="voiceBtn" onclick="toggleRecording()">
                <span class="voice-btn-icon">üé§</span>
                <span id="voiceBtnLabel" data-t="recordIdea"></span>
            </button>
            
            <div class="form-section">
                <div class="form-label" data-t="category"></div>
                <div class="category-grid" id="categoryGrid"></div>
            </div>
            
            <div class="form-section">
                <div class="form-label" data-t="titleOptional"></div>
                <input type="text" class="input-field" id="ideaTitleInput" data-tp="titlePlaceholder">
            </div>
            
            <button class="btn btn-primary btn-full" id="saveIdeaBtn" onclick="saveIdea()" disabled data-t="saveIdea"></button>
        </div>
    </div>
    
    <!-- DETAIL SCREEN -->
    <div id="detail" class="screen">
        <div class="screen-content">
            <div class="detail-nav">
                <button class="back-btn" onclick="navigateTo('main')">‚Üê <span data-t="back"></span></button>
                <div class="header-actions">
                    <button class="icon-btn" onclick="editIdea()">‚úèÔ∏è</button>
                    <button class="icon-btn" onclick="deleteIdea()">üóëÔ∏è</button>
                </div>
            </div>
            
            <div class="detail-badge" id="detailBadge"></div>
            <h1 class="detail-title" id="detailTitle"></h1>
            <p class="detail-meta" id="detailMeta"></p>
            <div class="detail-content" id="detailContent"></div>
            
            <div class="action-grid">
                <div class="action-card" onclick="showInsights()">
                    <div class="action-icon">üí°</div>
                    <div class="action-label" data-t="insights"></div>
                </div>
                <div class="action-card" onclick="showRoadmap()">
                    <div class="action-icon">üó∫Ô∏è</div>
                    <div class="action-label" data-t="roadmap"></div>
                </div>
            </div>
            
            <div class="section-header">
                <h2 class="section-title" data-t="askMentor"></h2>
                <p class="section-desc" data-t="askMentorDesc"></p>
            </div>
            
            <div class="mentor-scroll" id="mentorScroll"></div>
            
            <div class="mentor-action-panel" id="mentorActionPanel">
                <div class="mentor-selected-header">
                    <div class="mentor-selected-avatar" id="selectedMentorAvatar"></div>
                    <div>
                        <div class="mentor-selected-name" id="selectedMentorName"></div>
                        <div class="mentor-selected-role" id="selectedMentorRole"></div>
                    </div>
                </div>
                <button class="btn btn-primary btn-full" id="askMentorBtn" onclick="askMentor()" data-t="getFeedback"></button>
                <div class="mentor-feedback" id="mentorFeedback">
                    <div class="mentor-feedback-text" id="mentorFeedbackText"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- CONNECTIONS SCREEN -->
    <div id="connections" class="screen">
        <div class="screen-content with-nav">
            <div class="header">
                <h1 class="header-title" data-t="connections"></h1>
            </div>
            <div class="connections-intro">
                <p class="section-desc" data-t="connectionsDesc"></p>
            </div>
            <div id="connectionsList"></div>
            <button class="btn btn-primary btn-full" id="findConnectionsBtn" onclick="findConnections()" style="margin-top: 24px;" data-t="findConnections"></button>
        </div>
    </div>
    
    <!-- SETTINGS SCREEN -->
    <div id="settings" class="screen">
        <div class="screen-content with-nav">
            <div class="header">
                <h1 class="header-title" data-t="settings"></h1>
                <button class="btn btn-ghost" onclick="navigateTo('main')" data-t="done"></button>
            </div>
            
            <div class="settings-section">
                <div class="settings-section-title" data-t="profile"></div>
                <div class="settings-card">
                    <div class="settings-item" onclick="editProfile()">
                        <div class="settings-item-left">
                            <span class="settings-item-icon">üë§</span>
                            <span class="settings-item-label" data-t="profession"></span>
                        </div>
                        <span class="settings-item-value" id="settingsProfession">-</span>
                    </div>
                    <div class="settings-item" onclick="toggleLanguage()">
                        <div class="settings-item-left">
                            <span class="settings-item-icon">üåê</span>
                            <span class="settings-item-label" data-t="language"></span>
                        </div>
                        <span class="settings-item-value" id="settingsLanguage">English</span>
                    </div>
                </div>
            </div>
            
            <div class="settings-section">
                <div class="settings-section-title" data-t="apiConfig"></div>
                <div class="settings-card">
                    <div class="settings-item" onclick="editApiKey()">
                        <div class="settings-item-left">
                            <span class="settings-item-icon">üîë</span>
                            <span class="settings-item-label" data-t="apiKey"></span>
                        </div>
                        <span class="api-display" id="settingsApiKey">‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>
                    </div>
                </div>
            </div>
            
            <div class="settings-section">
                <div class="settings-section-title" data-t="data"></div>
                <div class="settings-card">
                    <div class="settings-item" onclick="exportData()">
                        <div class="settings-item-left">
                            <span class="settings-item-icon">üì§</span>
                            <span class="settings-item-label" data-t="exportBackup"></span>
                        </div>
                    </div>
                    <div class="settings-item" onclick="importData()">
                        <div class="settings-item-left">
                            <span class="settings-item-icon">üì•</span>
                            <span class="settings-item-label" data-t="importBackup"></span>
                        </div>
                    </div>
                    <div class="settings-item danger" onclick="clearAllData()">
                        <div class="settings-item-left">
                            <span class="settings-item-icon">üóëÔ∏è</span>
                            <span class="settings-item-label" data-t="deleteAll"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- FAB -->
    <div class="fab-container" id="fabContainer">
        <button class="fab" id="fab" onclick="navigateTo('capture')">üé§</button>
    </div>
    
    <!-- Recording Indicator -->
    <div class="recording-indicator" id="recordingIndicator">
        <div class="recording-dot"></div>
        <div class="recording-time" id="recordingTime">00:00</div>
    </div>
    
    <!-- Bottom Nav -->
    <div class="bottom-nav" id="bottomNav">
        <button class="nav-item active" data-screen="main" onclick="navigateTo('main')">
            <span class="nav-icon">üí°</span>
            <span data-t="nav.ideas"></span>
        </button>
        <button class="nav-item" data-screen="connections" onclick="navigateTo('connections')">
            <span class="nav-icon">üîó</span>
            <span data-t="nav.connections"></span>
        </button>
        <button class="nav-item" data-screen="settings" onclick="navigateTo('settings')">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span data-t="nav.settings"></span>
        </button>
    </div>
    
    <!-- Modals -->
    <div class="modal-overlay" id="insightsModal" onclick="if(event.target===this)closeModal('insightsModal')">
        <div class="modal">
            <div class="modal-handle"></div>
            <div class="modal-header">
                <h3 class="modal-title">üí° <span data-t="insights"></span></h3>
                <button class="modal-close" onclick="closeModal('insightsModal')">√ó</button>
            </div>
            <div class="modal-content" id="insightsContent"></div>
        </div>
    </div>
    
    <div class="modal-overlay" id="roadmapModal" onclick="if(event.target===this)closeModal('roadmapModal')">
        <div class="modal">
            <div class="modal-handle"></div>
            <div class="modal-header">
                <h3 class="modal-title">üó∫Ô∏è <span data-t="roadmap"></span></h3>
                <button class="modal-close" onclick="closeModal('roadmapModal')">√ó</button>
            </div>
            <div class="modal-content" id="roadmapContent"></div>
        </div>
    </div>
    
    <div class="modal-overlay" id="categoryModal" onclick="if(event.target===this)closeModal('categoryModal')">
        <div class="modal">
            <div class="modal-handle"></div>
            <div class="modal-header">
                <h3 class="modal-title" data-t="newCategory"></h3>
                <button class="modal-close" onclick="closeModal('categoryModal')">√ó</button>
            </div>
            <div class="form-section">
                <div class="form-label" data-t="categoryName"></div>
                <input type="text" class="input-field" id="newCategoryName" placeholder="e.g., Hobbies">
            </div>
            <div class="form-section">
                <div class="form-label" data-t="categoryEmoji"></div>
                <input type="text" class="input-field" id="newCategoryEmoji" placeholder="üéÆ" maxlength="2">
            </div>
            <button class="btn btn-primary btn-full" onclick="createCategory()" data-t="createCategory"></button>
        </div>
    </div>
    
    <!-- Toast -->
    <div class="toast" id="toast"></div>
    
    <!-- Hidden file input -->
    <input type="file" id="importInput" accept=".json" style="display:none">
</div>
 state.selectedMentor,
            feedback,
            date: new Date().toISOString()
        });
        saveState();
        updateStats();
        
        // Show feedback
        document.getElementById('mentorFeedbackText').textContent = feedback;
        document.getElementById('mentorFeedback').classList.add('visible');
        haptic([50, 30, 50]);
        
    } catch (e) {
        console.error('Mentor error:', e);
        showToast(t('toast.error'), 'error');
    }
    
    btn.disabled = false;
    btn.innerHTML = t('getFeedback');
}

// ============ INSIGHTS & ROADMAP ============
async function showInsights() {
    haptic();
    openModal('insightsModal');
    document.getElementById('insightsContent').innerHTML = `<div class="loading-container"><div class="spinner"></div><div class="loading-text">Analyzing...</div></div>`;
    
    const lang = state.user?.lang || 'en';
    
    try {
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${state.user.apiKey}`
            },
            body: JSON.stringify({
                model: 'gpt-4o',
                messages: [
                    { role: 'system', content: `Generate deep insights: üíé Unique value proposition, üéØ Ideal target audience, ‚ö†Ô∏è Primary risk, üöÄ Non-obvious opportunity, üí° Powerful question to reflect on. Be concise. Respond in ${lang === 'es' ? 'Spanish' : 'English'}.` },
                    { role: 'user', content: `Context: ${state.user.profession}. ${state.user.context || ''}\n\nIdea: "${state.currentIdea.title}"\n${state.currentIdea.content}` }
                ],
                max_tokens: 600
            })
        });
        
        const data = await response.json();
        document.getElementById('insightsContent').innerHTML = data.choices[0].message.content;
    } catch (e) {
        document.getElementById('insightsContent').innerHTML = t('toast.error');
    }
}

async function showRoadmap() {
    haptic();
    openModal('roadmapModal');
    document.getElementById('roadmapContent').innerHTML = `<div class="loading-container"><div class="spinner"></div><div class="loading-text">Creating roadmap...</div></div>`;
    
    const lang = state.user?.lang || 'en';
    
    try {
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${state.user.apiKey}`
            },
            body: JSON.stringify({
                model: 'gpt-4o',
                messages: [
                    { role: 'system', content: `Create a practical roadmap: üìÖ WEEK 1, üìÖ WEEKS 2-4, üìÖ MONTHS 2-3, üí∞ Estimated investment, ‚è±Ô∏è Time to MVP. Be realistic and specific. Respond in ${lang === 'es' ? 'Spanish' : 'English'}.` },
                    { role: 'user', content: `Context: ${state.user.profession}. ${state.user.context || ''}\n\nIdea: "${state.currentIdea.title}"\n${state.currentIdea.content}` }
                ],
                max_tokens: 800
            })
        });
        
        const data = await response.json();
        document.getElementById('roadmapContent').innerHTML = data.choices[0].message.content;
    } catch (e) {
        document.getElementById('roadmapContent').innerHTML = t('toast.error');
    }
}

// ============ CONNECTIONS ============
async function findConnections() {
    if (state.ideas.length < 3) {
        showToast(t('toast.needMore'), 'error');
        return;
    }
    
    haptic();
    const btn = document.getElementById('findConnectionsBtn');
    btn.disabled = true;
    btn.innerHTML = '<div class="spinner" style="width:20px;height:20px;border-width:2px;display:inline-block;vertical-align:middle;margin-right:10px"></div> Analyzing...';
    
    const lang = state.user?.lang || 'en';
    const summary = state.ideas.map(i => `- ${i.title}: ${i.content.substring(0, 80)}`).join('\n');
    
    try {
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${state.user.apiKey}`
            },
            body: JSON.stringify({
                model: 'gpt-4o',
                messages: [
                    { role: 'system', content: `Find 2-3 groups of connected ideas. Respond in JSON only: {"connections":[{"theme":"...","ideas":["title1","title2"],"insight":"how they could combine..."}]}. Respond in ${lang === 'es' ? 'Spanish' : 'English'}.` },
                    { role: 'user', content: `My ideas:\n${summary}` }
                ],
                max_tokens: 800
            })
        });
        
        const data = await response.json();
        const content = data.choices[0].message.content.replace(/```json\n?|\n?```/g, '');
        state.connections = JSON.parse(content).connections;
        saveState();
        renderConnections();
        haptic([50, 30, 50]);
        
    } catch (e) {
        console.error('Connections error:', e);
        showToast(t('toast.error'), 'error');
    }
    
    btn.disabled = false;
    btn.innerHTML = t('findConnections');
}

function renderConnections() {
    const container = document.getElementById('connectionsList');
    
    if (!state.connections?.length) {
        container.innerHTML = `
            <div class="empty-state">
                <div class="empty-icon">üîó</div>
                <h3 class="empty-title">${t('conn.empty.title')}</h3>
                <p class="empty-desc">${t('conn.empty.desc')}</p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = state.connections.map(conn => `
        <div class="connection-card">
            <div class="connection-theme">üîó ${conn.theme}</div>
            <div class="connection-ideas">
                ${conn.ideas.map(title => {
                    const idea = state.ideas.find(i => i.title === title);
                    return `<div class="connection-idea-item" ${idea ? `onclick="viewIdea('${idea.id}')"` : ''}>${title}</div>`;
                }).join('')}
            </div>
            <div class="connection-insight">${conn.insight}</div>
        </div>
    `).join('');
}

// ============ SETTINGS ============
function updateSettingsDisplay() {
    document.getElementById('settingsProfession').textContent = state.user?.profession || '-';
    document.getElementById('settingsLanguage').textContent = state.user?.lang === 'es' ? 'Espa√±ol' : 'English';
    const apiKey = state.user?.apiKey || '';
    document.getElementById('settingsApiKey').textContent = apiKey ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢' + apiKey.slice(-4) : '‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
}

function editProfile() {
    haptic();
    const newProf = prompt('Profession:', state.user?.profession || '');
    if (newProf !== null) {
        state.user.profession = newProf;
        const newCtx = prompt('Context:', state.user?.context || '');
        if (newCtx !== null) state.user.context = newCtx;
        saveState();
        updateSettingsDisplay();
    }
}

function toggleLanguage() {
    haptic();
    state.user.lang = state.user?.lang === 'es' ? 'en' : 'es';
    saveState();
    updateTexts();
    updateSettingsDisplay();
    renderCategories();
    renderMentors();
    renderIdeas();
}

function editApiKey() {
    haptic();
    const newKey = prompt('Enter new API key:');
    if (newKey && newKey.startsWith('sk-')) {
        state.user.apiKey = newKey;
        saveState();
        updateSettingsDisplay();
    }
}

function exportData() {
    haptic();
    const data = {
        user: { ...state.user, apiKey: undefined },
        ideas: state.ideas,
        categories: state.categories,
        connections: state.connections,
        exportedAt: new Date().toISOString()
    };
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `ideaforge-backup-${new Date().toISOString().split('T')[0]}.json`;
    a.click();
    showToast('Backup exported', 'success');
}

function importData() {
    haptic();
    document.getElementById('importInput').click();
}

document.getElementById('importInput').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (evt) => {
        try {
            const data = JSON.parse(evt.target.result);
            if (data.ideas) {
                state.ideas = data.ideas;
                state.categories = data.categories || state.categories;
                state.connections = data.connections || [];
                saveState();
                renderIdeas();
                updateStats();
                renderCategories();
                showToast('Data imported', 'success');
            }
        } catch (err) {
            showToast(t('toast.error'), 'error');
        }
    };
    reader.readAsText(file);
    this.value = '';
});

function clearAllData() {
    haptic();
    if (confirm('Delete ALL data? This cannot be undone.')) {
        if (confirm('Are you absolutely sure?')) {
            localStorage.removeItem('ideaforge-v2');
            location.reload();
        }
    }
}

// ============ IDEA ACTIONS ============
function editIdea() {
    haptic();
    if (!state.currentIdea) return;
    const newContent = prompt('Edit idea:', state.currentIdea.content);
    if (newContent !== null && newContent.trim()) {
        state.currentIdea.content = newContent.trim();
        const newTitle = prompt('Edit title:', state.currentIdea.title);
        if (newTitle !== null && newTitle.trim()) {
            state.currentIdea.title = newTitle.trim();
        }
        saveState();
        document.getElementById('detailTitle').textContent = state.currentIdea.title;
        document.getElementById('detailContent').textContent = state.currentIdea.content;
    }
}

function deleteIdea() {
    haptic();
    if (!state.currentIdea) return;
    if (confirm('Delete this idea?')) {
        state.ideas = state.ideas.filter(i => i.id !== state.currentIdea.id);
        saveState();
        showToast(t('toast.deleted'));
        navigateTo('main');
    }
}

// ============ CATEGORIES ============
function createCategory() {
    haptic();
    const name = document.getElementById('newCategoryName').value.trim();
    const emoji = document.getElementById('newCategoryEmoji').value.trim() || 'üìå';
    if (!name) return;
    
    const id = name.toLowerCase().replace(/\s+/g, '-');
    const colors = ['#00d4aa', '#7c3aed', '#f59e0b', '#ec4899', '#3b82f6', '#10b981'];
    const color = colors[state.categories.length % colors.length];
    
    state.categories.push({ id, emoji, color });
    saveState();
    renderCategories();
    closeModal('categoryModal');
    
    document.getElementById('newCategoryName').value = '';
    document.getElementById('newCategoryEmoji').value = '';
}

// ============ SEARCH ============
function searchIdeas() {
    haptic();
    const query = prompt('Search ideas:');
    if (query?.trim()) {
        const results = state.ideas.filter(i => 
            i.title.toLowerCase().includes(query.toLowerCase()) ||
            i.content.toLowerCase().includes(query.toLowerCase())
        );
        if (results.length === 1) {
            viewIdea(results[0].id);
        } else if (results.length > 1) {
            // Temporarily filter to show only results
            const originalIdeas = [...state.ideas];
            state.ideas = results;
            renderIdeas();
            state.ideas = originalIdeas;
        }
    }
}

// ============ MODALS & TOAST ============
function openModal(id) {
    haptic();
    document.getElementById(id).classList.add('visible');
}

function closeModal(id) {
    haptic();
    document.getElementById(id).classList.remove('visible');
}

function showToast(message, type = '') {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.className = 'toast visible' + (type ? ` ${type}` : '');
    setTimeout(() => toast.classList.remove('visible'), 3000);
}

// ============ INITIALIZATION ============
function init() {
    loadState();
    
    if (state.user?.apiKey) {
        // User has completed onboarding - go directly to main
        navigateTo('main');
    } else {
        // Show onboarding
        navigateTo('onboarding');
    }
    
    updateTexts();
    renderCategories();
    renderMentors();
}

// Start the app
init();
</script>
</body>
</html>
